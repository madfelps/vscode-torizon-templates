{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "build-debug-x86",
      "command": "go",
      "type": "shell",
      "args": ["build", "${workspaceFolder}/src/main.go"],
      "problemMatcher": [
        {
          "owner": "go run",
          "fileLocation": ["relative", "${workspaceRoot}"],
          "pattern": {
            "regexp": "^(.*):(\\d+):(\\d+):\\s+(\\d+):(\\d+)\\s+(warning|error):\\s+(.*)$",
            "file": 1,
            "line": 2,
            "column": 3,
            "endLine": 4,
            "endColumn": 5,
            "severity": 6,
            "message": 7
          }
        }
      ],
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      },
      "dependsOrder": "sequence"
    },
    {
      "label": "build-container-image-sdk-arm64",
      "command": "docker",
      "type": "shell",
      "args": [
        "build",
        "-f",
        "${workspaceFolder}/Dockerfile.sdk",
        "${workspaceFolder}",
        "-t",
        "cross-toolchain-arm64-__container__"
      ],
      "problemMatcher": [
        {
          "owner": "rust",
          "fileLocation": ["relative", "${workspaceRoot}"],
          "pattern": {
            "regexp": "^(.*):(\\d+):(\\d+):\\s+(\\d+):(\\d+)\\s+(warning|error):\\s+(.*)$",
            "file": 1,
            "line": 2,
            "column": 3,
            "endLine": 4,
            "endColumn": 5,
            "severity": 6,
            "message": 7
          }
        }
      ],
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "build-debug-arm64",
      "command": "env",
      "type": "shell",
      "args": [
        "CGO_ENABLED=0",
        "GOOS=linux",
        "GOARCH=arm64",
        "go",
        "build",
        "-gcflags",
        "\"all=-N",
        "-l\"",
        "./src/main.go"
      ],
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      },
      "dependsOrder": "sequence"
    },
    {
      "label": "pre-cleanup-arm64",
      "detail": "hide",
      "command": "sshpass",
      "type": "process",
      "args": [
        "-p",
        "${config:torizon_psswd}",
        "ssh",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "torizon@${config:torizon_ip}",
        "LOCAL_REGISTRY=${config:host_ip} TAG=arm64 docker-compose down --remove-orphans"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "build-container-torizon-debug-arm64_t",
      "detail": "hide",
      "command": "docker-compose",
      "type": "process",
      "options": {
        "env": {
          "LOCAL_REGISTRY": "localhost",
          "TAG": "arm64"
        }
      },
      "args": [
        "build",
        "--build-arg",
        "IMAGE_ARCH=arm64",
        "__container__-debug"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "build-container-torizon-debug-arm64",
      "detail": "hide",
      "command": "docker-compose",
      "type": "process",
      "options": {
        "env": {
          "LOCAL_REGISTRY": "localhost",
          "TAG": "arm64"
        }
      },
      "args": [
        "build",
        "--build-arg",
        "IMAGE_ARCH=arm64",
        "__container__-debug"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "push-container-torizon-debug-arm64",
      "detail": "hide",
      "command": "docker-compose",
      "type": "process",
      "options": {
        "env": {
          "LOCAL_REGISTRY": "localhost",
          "TAG": "arm64"
        }
      },
      "args": ["push", "__container__-debug"],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "pull-container-torizon-debug-arm64",
      "detail": "hide",
      "command": "sshpass",
      "type": "process",
      "args": [
        "-p",
        "${config:torizon_psswd}",
        "ssh",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "torizon@${config:torizon_ip}",
        "LOCAL_REGISTRY=${config:host_ip} TAG=arm64 docker-compose pull __container__-debug"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "run-container-torizon-debug-arm64",
      "detail": "hide",
      "command": "sshpass",
      "type": "process",
      "args": [
        "-p",
        "${config:torizon_psswd}",
        "ssh",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "torizon@${config:torizon_ip}",
        "LOCAL_REGISTRY=${config:host_ip} TAG=arm64 docker-compose up -d __container__-debug"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "deploy-torizon-arm64",
      "detail": "hide",
      "command": "scp",
      "type": "process",
      "args": [
        "-i",
        "${workspaceFolder}/.conf/id_rsa",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "-P",
        "${config:torizon_debug_ssh_port}",
        "-pr",
        "${workspaceFolder}/target/aarch64-unknown-linux-gnu/debug",
        "torizon@${config:torizon_ip}:~/app"
      ],
      "dependsOn": [
        "copy-docker-compose",
        "pre-cleanup-arm64",
        "build-debug-arm64",
        "build-container-torizon-debug-arm64",
        "push-container-torizon-debug-arm64",
        "pull-container-torizon-debug-arm64",
        "run-container-torizon-debug-arm64"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "build-container-image-sdk-arm",
      "command": "docker",
      "type": "shell",
      "args": [
        "build",
        "-f",
        "${workspaceFolder}/Dockerfile.sdk",
        "${workspaceFolder}",
        "-t",
        "cross-toolchain-arm-__container__"
      ],
      "problemMatcher": [
        {
          "owner": "rust",
          "fileLocation": ["relative", "${workspaceRoot}"],
          "pattern": {
            "regexp": "^(.*):(\\d+):(\\d+):\\s+(\\d+):(\\d+)\\s+(warning|error):\\s+(.*)$",
            "file": 1,
            "line": 2,
            "column": 3,
            "endLine": 4,
            "endColumn": 5,
            "severity": 6,
            "message": 7
          }
        }
      ],
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "build-debug-arm",
      "command": "env",
      "type": "shell",
      "args": [
        "CGO_ENABLED=0",
        "GOOS=linux",
        "GOARCH=arm",
        "go",
        "build",
        "-gcflags",
        "\"all=-N",
        "-l\"",
        "./src/main.go"
      ],
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      },
      "dependsOrder": "sequence"
    },
    {
      "label": "pre-cleanup-arm",
      "detail": "hide",
      "command": "sshpass",
      "type": "process",
      "args": [
        "-p",
        "${config:torizon_psswd}",
        "ssh",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "torizon@${config:torizon_ip}",
        "LOCAL_REGISTRY=${config:host_ip} TAG=arm docker-compose down --remove-orphans"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "build-container-torizon-debug-arm",
      "detail": "hide",
      "command": "docker-compose",
      "type": "process",
      "options": {
        "env": {
          "LOCAL_REGISTRY": "localhost",
          "TAG": "arm"
        }
      },
      "args": [
        "build", 
        "--build-arg", 
        "IMAGE_ARCH=arm", 
        "__container__-debug"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "push-container-torizon-debug-arm",
      "detail": "hide",
      "command": "docker-compose",
      "type": "process",
      "options": {
        "env": {
          "LOCAL_REGISTRY": "localhost",
          "TAG": "arm"
        }
      },
      "args": ["push", "__container__-debug"],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "pull-container-torizon-debug-arm",
      "detail": "hide",
      "command": "sshpass",
      "type": "process",
      "args": [
        "-p",
        "${config:torizon_psswd}",
        "ssh",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "torizon@${config:torizon_ip}",
        "LOCAL_REGISTRY=${config:host_ip} TAG=arm docker-compose pull __container__-debug"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "run-container-torizon-debug-arm",
      "detail": "hide",
      "command": "sshpass",
      "type": "process",
      "args": [
        "-p",
        "${config:torizon_psswd}",
        "ssh",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "torizon@${config:torizon_ip}",
        "LOCAL_REGISTRY=${config:host_ip} TAG=arm docker-compose up -d __container__-debug"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "deploy-torizon-arm",
      "detail": "hide",
      "command": "scp",
      "type": "process",
      "args": [
        "-i",
        "${workspaceFolder}/.conf/id_rsa",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "-P",
        "${config:torizon_debug_ssh_port}",
        "-pr",
        "${workspaceFolder}/target/armv7-unknown-linux-gnueabihf/debug",
        "torizon@${config:torizon_ip}:~/app"
      ],
      "dependsOn": [
        "copy-docker-compose",
        "pre-cleanup-arm",
        "build-debug-arm",
        "build-container-torizon-debug-arm",
        "push-container-torizon-debug-arm",
        "pull-container-torizon-debug-arm",
        "run-container-torizon-debug-arm"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "wait-debugger-start-arm",
      "detail": "hide",
      "command": "sleep",
      "type": "process",
      "args": ["2"],
      "dependsOn": [
        "validate-settings",
        "validate-arch-arm",
        "apply-torizon-packages",
        "copy-docker-compose",
        "pre-cleanup-arm",
        "build-debug-arm",
        "build-container-torizon-debug-arm",
        "push-container-torizon-debug-arm",
        "pull-container-torizon-debug-arm",
        "run-container-torizon-debug-arm",
        "wait-a-bit",
        "pos-cleanup",
        "deploy-torizon-arm",
        "start-torizon-debug-arm"
      ],
      "dependsOrder": "sequence",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "start-torizon-debug-arm",
      "detail": "hide",
      "command": "ssh",
      "type": "process",
      "args": [
        "-i",
        "${workspaceFolder}/.conf/id_rsa",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "-p",
        "${config:torizon_debug_ssh_port}",
        "torizon@${config:torizon_ip}",
        "/home/torizon/go/bin/dlv exec /home/torizon/main --listen=:2345 --headless=true --log=true --log-output=debugger,debuglineerr,gdbwire,lldbout,rpc --accept-multiclient --api-version=2 > out.log 2> err.log &"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "wait-debugger-start-arm64",
      "detail": "hide",
      "command": "sleep",
      "type": "process",
      "args": ["2"],
      "dependsOn": [
        "validate-settings",
        "validate-arch-arm64",
        "apply-torizon-packages",
        "copy-docker-compose",
        "pre-cleanup-arm64",
        "build-debug-arm64",
        "build-container-torizon-debug-arm64",
        "push-container-torizon-debug-arm64",
        "pull-container-torizon-debug-arm64",
        "run-container-torizon-debug-arm64",
        "wait-a-bit",
        "pos-cleanup",
        "deploy-torizon-arm64",
        "start-torizon-debug-arm64"
      ],
      "dependsOrder": "sequence",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    },
    {
      "label": "start-torizon-debug-arm64",
      "detail": "hide",
      "command": "ssh",
      "type": "process",
      "args": [
        "-i",
        "${workspaceFolder}/.conf/id_rsa",
        "-o",
        "UserKnownHostsFile=/dev/null",
        "-o",
        "StrictHostKeyChecking=no",
        "-p",
        "${config:torizon_debug_ssh_port}",
        "torizon@${config:torizon_ip}",
        "/home/torizon/go/bin/dlv exec /home/torizon/main --listen=:2345 --headless=true --log=true --log-output=debugger,debuglineerr,gdbwire,lldbout,rpc --accept-multiclient --api-version=2 > out.log 2> err.log &"
      ],
      "dependsOrder": "sequence",
      "problemMatcher": "$msCompile",
      "icon": {
        "id": "flame",
        "color": "terminal.ansiYellow"
      }
    }
  ],
  "inputs": [
    {
      "id": "dockerLogin",
      "type": "promptString",
      "description": "Container Registry Login"
    },
    {
      "id": "dockerImageRegistry",
      "type": "promptString",
      "description": "Image Registry"
    },
    {
      "id": "dockerImageTag",
      "type": "promptString",
      "description": "Image Tag"
    },
    {
      "id": "dockerImageGpu",
      "type": "promptString",
      "description": "Image GPU"
    },
    {
      "id": "dockerPsswd",
      "type": "promptString",
      "password": true,
      "description": "Container Registry Password"
    },
    {
      "id": "archList",
      "type": "pickString",
      "description": "Container architecture",
      "options": ["arm", "arm64"]
    }
  ]
}
